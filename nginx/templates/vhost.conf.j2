server {
    listen 80;
    listen [::]:80;
    server_name {{ item.domain }};

    root /var/www/{{ item.name }}/public;

    {% if item.backend == 'laravel' %}

    index index.html index.htm index.php;

    {% endif %}

    error_page 404 /index.php;

    location / {
        # try to serve file directly, fallback to index.php
        try_files $uri /index.php$is_args$args;
    }

    {% if php_version %}

    location ~ ^/index\.php(/|$) {
        include partials/php_fastcgi.conf;
    }

    {% endif %}

    # return 404 for all other php files not matching the front controller
    # this prevents access to other php files you don't want to be accessible.
    location ~ \.php$ {
        return 404;
    }

    error_log /var/log/nginx/{{ item.name }}/project_error.log;
    access_log /var/log/nginx/{{ item.name }}/project_access.log;

    include partials/general.conf;
}